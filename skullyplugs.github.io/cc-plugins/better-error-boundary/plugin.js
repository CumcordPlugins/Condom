(function(p,r,e,v,x,o,L){"use strict";const T=r.findByDisplayName("ArrowDropDown"),B=r.findByDisplayName("ArrowDropUp");class w extends e.React.Component{constructor(t){super(t);this.state={open:!1}}render(){const{content:t,openTxt:a,closedTxt:n}=this.props;return e.React.createElement(e.React.Fragment,null,e.React.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>this.setState({open:!this.state.open})},this.state.open?e.React.createElement(B,null):e.React.createElement(T,null),e.React.createElement("p",null,this.state.open?n:a)),e.React.createElement("div",{style:{display:this.state.open?"block":"none",textAlign:"left",marginLeft:"2%"}},t))}}const{defaultRules:{codeBlock:{react:N}}}=r.findByProps("parse","parseTopic"),I=r.findByDisplayName("Card");var U=({error:s})=>(L.useNest(o.persist),e.React.createElement(e.React.Fragment,null,e.React.createElement("p",null,"Discord has crashed."),e.React.createElement("p",null,"Short Message: ",e.React.createElement("code",null,s.message)),e.React.createElement(I,{style:{padding:"10px"}},e.React.createElement(w,{content:N({content:s.stack,lang:o.persist.ghost.lang},null,{}),openTxt:"Click to reveal full error",closedTxt:"Click to hide full error"}))));const y=/https?:\/\/reactjs\.org\/docs\/error-decoder\.html\?invariant=([0-9]+)(?:[^ ])+/,{iconWrapper:S,clickable:$,icon:D}=r.findByProps("iconWrapper","clickable"),A=r.findByDisplayName("Tooltip"),g=r.findByDisplayName("Spinner",!1);class P extends e.React.Component{constructor(){super();this.state={doCrash:!1}}render(){return e.React.createElement(A,{position:"bottom",text:"Crash Discord",color:"red"},({onMouseEnter:t,onMouseLeave:a})=>e.React.createElement("div",{className:[S,$].join(" "),onMouseEnter:t,onMouseLeave:a,onClick:()=>{p.instead("default",g,(n,c)=>{}),this.setState({doCrash:!this.state.doCrash})}},this.state.doCrash?e.React.createElement(g,null):e.React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:D,viewBox:"0 0 16 16"},e.React.createElement("path",{d:"M9.05.435c-.58-.58-1.52-.58-2.1 0L.436 6.95c-.58.58-.58 1.519 0 2.098l6.516 6.516c.58.58 1.519.58 2.098 0l6.516-6.516c.58-.58.58-1.519 0-2.098L9.05.435zM8 4c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995A.905.905 0 0 1 8 4zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"}))))}}var R=({preview:s,showLocalTime:t})=>{const a=new Date;return(s?`// THIS IS A CRASH LOG PREVIEW LOL
`:"")+`// Discord Version: ${DiscordNative.app.getVersion()}-${DiscordNative.app.getReleaseChannel()}
// Platform: ${DiscordNative.process.platform}
// Crash Time: ${a} ${t?"("+a.toLocaleString()+")":""}

`};const{defaultRules:{codeBlock:{react:z}}}=findByProps("parse","parseTopic"),d=r.findByDisplayName("SwitchItem"),k=r.findByDisplayName("FormItem");r.findByDisplayName("FormText");const M=r.findByDisplayName("RadioGroup"),F=r.findByDisplayName("Card");r.findByDisplayName("Text");class b extends e.React.Component{constructor(){super();this.funniError=new Error("This is a funni test error")}regenContent(t,a,{showLocalTime:n}){return(a?R({preview:!0,showLocalTime:n}):"")+t.stack}render(){return e.React.createElement(e.React.Fragment,null,e.React.createElement(d,{note:"Reveals a button in the channel header that crashes the client. (used for testing purposes)",value:o.persist.ghost.showUtils,onChange:()=>{o.persist.store.showUtils=!o.persist.store.showUtils,this.forceUpdate()}},"Show Crash Button"),e.React.createElement(k,{title:"Language Choice"},e.React.createElement(M,{options:[{name:"Javascript (JS)",value:"js"},{name:"PlainText (TXT)",value:"txt"}],onChange:t=>{o.persist.store.lang=t.value,this.forceUpdate()},value:o.persist.ghost.lang}),e.React.createElement(d,{note:"Adds more info to the top of your error. (only shown on saved crash)",value:o.persist.ghost.extInfo,onChange:()=>{o.persist.store.extInfo=!o.persist.store.extInfo,this.forceUpdate()}},"Enable Extra Info"),e.React.createElement(d,{disabled:!o.persist.ghost.extInfo,value:o.persist.ghost.showLocalTime,onChange:()=>{o.persist.store.showLocalTime=!o.persist.store.showLocalTime,this.forceUpdate()}},"Show Local Time"),e.React.createElement(F,{style:{margin:"10px"}},z({content:this.regenContent(this.funniError,o.persist.ghost.extInfo,{showLocalTime:o.persist.ghost.showLocalTime}),lang:o.persist.ghost.lang},null,{}))))}}let E,C,h;var j=s=>({onLoad(){let t,a=!1;const n=r.findByDisplayName("ErrorBoundary",!1),{sizeLarge:c,colorBrand:m}=r.findByProps("sizeLarge"),u=r.findByProps("DropdownSizes");typeof s.persist.ghost?.showUtils!="boolean"&&(s.persist.ghost.showUtils=!1),typeof s.persist.ghost?.lang!="string"&&(s.persist.ghost.lang="js"),typeof s.persist.ghost?.extInfo!="boolean"&&(s.persist.ghost.extInfo=!0),C=p.before("componentDidCatch",n.default.prototype,f=>t=f[0]),E=p.after("render",n.default.prototype,(f,i)=>{!i.props.note||(i.props.title="oh noes :o",i.props.note.props.children=[e.React.createElement(U,{error:t})],t&&!a&&(a=!0,i.props.action.props.children[0].props.children="(L) Reload / (R) Relaunch",i.props.action.props.children[0].props.onContextMenu=()=>DiscordNative.app.relaunch(),i.props.action.props.children.push(e.React.createElement(u,{children:"Copy Stack to Clipboard",size:c,color:m,style:{marginLeft:"10px"},onClick:()=>{DiscordNative.clipboard.copy(`\`\`\`${s.persist.ghost.lang}
`+t.stack+"```"),v.showToast({title:"Better Error Boundary",content:"The stack has been copied to your clipboard.",duration:5e3})}})),y.test(t.message)&&i.props.action.props.children.push(e.React.createElement(u,{children:"Open React Error Link",size:c,style:{marginLeft:"10px"},onClick:()=>window.open(y.exec(t.message)[0],"_blank")})),i.props.action.props.children.push(e.React.createElement(u,{children:"Save Error to File",size:c,color:m,style:{marginLeft:"10px"},onClick:()=>{const l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent((s.persist.ghost.extInfo?R({preview:!1,showLocalTime:s.persist.ghost.showLocalTime}):"")+t.stack)),l.setAttribute("download",`discord-crash-report.${s.persist.ghost.lang}`),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}))))}),s.persist.on(x.Events.SET,(f,{path:i,value:l})=>{i[0]==="showUtils"&&(l?this.createUtilsPatch():h?.())}),s.persist.ghost.showUtils&&this.createUtilsPatch()},createUtilsPatch(){const t=r.findByDisplayName("HeaderBar",!1);h=p.after("default",t,(a,n)=>{try{n.props.children.props.children[1].props.children.props.children[0].some(c=>c.key==="crash")||n.props.children.props.children[1].props.children.props.children[0].push(e.React.createElement(P,{key:"crash"}))}catch{}})},onUnload(){E?.(),C?.(),h?.()},settings:e.React.createElement(b)});return j})(cumcord.patcher,cumcord.modules.webpack,cumcord.modules.common,cumcord.ui.toasts,cumcord.modules.internal.nests,cumcord.pluginData,cumcord.utils);
