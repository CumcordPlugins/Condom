(function(m,k,P,U,a,d,x){"use strict";function F(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,Object.freeze(e)}var r=F(U);function E(...n){return d.findAsync(()=>d.findByProps.apply(this,n))}function p(n,e=!0){return d.findAsync(()=>d.findByDisplayName(n,e))}function I(n,e){return()=>{n--,n==0&&e()}}const W=d.findByDisplayName("SwitchItem"),S=d.findByDisplayName("FormSection"),y=d.findByDisplayName("FormTitle"),w={blockedMessageHide:!1,dmCleanup:!1,nitroHide:!1,paymentSettingsHide:!1,serverIconHide:!1,serverBannerHide:!1,activityBlock:!1,botTagHide:!1,buttonToHideChannelList:!0,logHelper:!0,earlyWarmUpAll:!1,errorFireAlarmTest:!1,logPowerStates:!1};function C(){let n={};for(let e in w)n[e]=m.persist.ghost[e]??w[e];return n}function l(n){const e=C();return r.createElement(W,{value:e[n.setting],onChange:t=>m.persist.store[n.setting]=t},n.children)}function N(){return x.useNest(m.persist),C(),r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"grid","grid-template-columns":"auto"}},r.createElement(S,null,r.createElement(y,null,"Cleanup"),r.createElement(l,{setting:"blockedMessageHide"},"Hide Blocked Messages"),r.createElement(l,{setting:"dmCleanup"},"Cleanup DM panel (Removes Nitro/Snowsgiving/etc. links)"),r.createElement(l,{setting:"nitroHide"},"Hide Nitro Features"),r.createElement(l,{setting:"paymentSettingsHide"},"Hide Payment Settings")),r.createElement(S,null,r.createElement(y,null,"Isolationism"),r.createElement(l,{setting:"serverIconHide"},"Hide Guild Icons"),r.createElement(l,{setting:"serverBannerHide"},"Hide Guild Banners"),r.createElement(l,{setting:"activityBlock"},"Hide Activities (Custom Statuses, etc.)")),r.createElement(S,null,r.createElement(y,null,"Utilities"),r.createElement(l,{setting:"botTagHide"},"Hide 'Bot' Tags (i.e. for PluralKit)"),r.createElement(l,{setting:"buttonToHideChannelList"},"Add a button to hide the channel list"),r.createElement(l,{setting:"logHelper"},"Add blank lines before message headers (for copy & paste)")),r.createElement(S,null,r.createElement(y,null,"Debug"),r.createElement(l,{setting:"earlyWarmUpAll"},"Warm-up all modules on load (even unused ones)"),r.createElement(l,{setting:"errorFireAlarmTest"},"Error Fire Alarm Test"),r.createElement(l,{setting:"logPowerStates"},"Spam console with module power state information"))))}const T=0,B=1,b=2,M=3,f=["COLD","WARMINGUP","WARM_OFF","ON"];class c{constructor(e){this.name=e,this.state=T,this.settings=w,this.powerOffHandler=()=>{}}updateSettings(e){this.settings=e}_powerStateTransition(e,t){if(this.state!=e)throw new Error("Was in "+f[this.state]+" and tried to transition from "+f[e]+" to "+f[t]);this.state=t,this.settings.logPowerStates&&console.log("GCAT: POWER:",this.name,f[e],f[t])}warmUp(e){this._powerStateTransition(T,B),this.warmUpHandler(()=>{this._powerStateTransition(B,b),e()})}powerOn(){this._powerStateTransition(b,M),this.powerOnHandler()}powerOff(){this._powerStateTransition(M,b),this.powerOffHandler()}warmUpHandler(e){e()}powerOnHandler(){}reportError(e,t){console.error(e,"in "+t,this),P.showToast({title:t+" error",content:this.name})}monitorPromise(e,t){e.then(t,i=>{this.reportError(i,"GCAT module monitored promise")})}}class L{constructor(){this.modules=new Map,this.modulesWantedOnline=new Set,this.settings=w}updateSettings(e){this.settings=e;for(let t of this.modules.values())t.updateSettings(e)}powerOffAll(){this.modulesWantedOnline.clear();for(let e of this.modules.values())this._refreshModulePowerState(e)}installModule(e){e.updateSettings(this.settings),this.modules.set(e.name,e),this.settings.earlyWarmUpAll&&this._startModuleWarmUpIfNotBusy(e),this._refreshModulePowerState(e)}_startModuleWarmUpIfNotBusy(e){if(e.state==T)try{e.warmUp(()=>this._refreshModulePowerState(e))}catch(t){e.reportError(t,"GCAT module warmUp")}}_refreshModulePowerState(e){if(this.modulesWantedOnline.has(e.name)){if(this._startModuleWarmUpIfNotBusy(e),e.state==b)try{e.powerOn()}catch(i){e.reportError(i,"GCAT module powerOn")}}else if(e.state==M)try{e.powerOff()}catch(i){e.reportError(i,"GCAT module powerOff")}}update(e,t){t?this.modulesWantedOnline.add(e):this.modulesWantedOnline.delete(e),this.modules.has(e)&&this._refreshModulePowerState(this.modules.get(e))}}class _ extends c{constructor(e,t){super(e);this.component=t,this._moduleVictim=null}warmUpHandler(e){this.monitorPromise(p(this.component,!1),t=>{this._moduleVictim=t,e()})}powerOnHandler(){this.powerOffHandler=a.after("default",this._moduleVictim,(e,t)=>r.createElement(r.Fragment,null))}}class v extends c{constructor(e,t){super(e);this.css=t}powerOnHandler(){this.powerOffHandler=a.injectCSS(this.css)}}class h extends c{constructor(e,t,i,s){super(e);this.sources=t,this.classTarget=i,this.css=s}warmUpHandler(e){this.monitorPromise(E.apply(this,this.sources),t=>{this._actualSource=t,e()})}powerOnHandler(){this.powerOffHandler=a.injectCSS("."+this._actualSource[this.classTarget]+" { "+this.css+" }")}}class G extends c{constructor(e){super(e)}powerOnHandler(){throw new Error("test error, please ignore")}}class D extends c{constructor(e){super(e)}warmUpHandler(e){this.monitorPromise(E("groupStart","message"),t=>{this._gsg=t,e()})}powerOnHandler(){this.powerOffHandler=a.injectCSS("."+this._gsg.groupStart+":not(."+this._gsg.message+`) { display: none; }
`)}}class j extends c{constructor(e){super(e)}warmUpHandler(e){this.monitorPromise(p("MessageHeader",!1),t=>{this._m=t,e()})}powerOnHandler(){this.powerOffHandler=a.after("default",this._m,(e,t)=>r.createElement(r.Fragment,null,r.createElement("p",{style:{margin:"0"}}),t))}}class R extends c{constructor(e){super(e)}warmUpHandler(e){this.monitorPromise(p("SettingsView",!0),t=>{this._m=t,e()})}powerOnHandler(){this.powerOffHandler=a.after("getPredicateSections",this._m.prototype,(e,t)=>{let i=!1;for(let s=0;s<t.length;s++){const o=t[s];o.section=="Discord Nitro"&&(i=!0,s!=0&&(t.splice(s-1,1),s--)),i&&(t.splice(s,1),s--),o.section=="DIVIDER"&&(i=!1)}return t})}}class V extends c{constructor(e){super(e)}warmUpHandler(e){this.monitorPromise(p("ConnectedPrivateChannelsList",!1),t=>{this._m=t,e()})}powerOnHandler(){const e=this;this.powerOffHandler=a.instead("default",this._m,function(t,i){if(t.length>0)try{const s=t[0].children;if(s!==void 0)for(let o=0;o<s.length;o++){const u=s[o];let g=e.settings.dmCleanup;typeof u=="object"&&u&&(u.key==="friends"&&(g=!1),u.key==="premium"&&(g=!0)),g&&(s.splice(o,1),o--)}}catch(s){e.reportError(s,"GCAT CPCL rebuild")}return i.apply(this,t)})}}class z extends c{constructor(e){super(e)}warmUpHandler(e){this.monitorPromise(p("SelectImageModal",!1),t=>{this._m=t,e()})}powerOnHandler(){const e=this;this.powerOffHandler=a.after("default",this._m,function(t,i){const s=x.findInReactTree(i,o=>{try{return o.className.startsWith("modalContent-")}catch(u){return!1}});if(!s)return console.error("Unable to find modal content for nitro avy upsell cleanup"),i;try{if(s.children.length!=2)return console.error("modal content children count is not as expected in nitro avy upsell cleanup"),i;s.children.splice(1,1)}catch(o){e.reportError(o,"GCAT during upsellAvy")}return i})}}class K extends c{constructor(e){super(e)}warmUpHandler(e){const t=I(2,e);this.monitorPromise(p("ChannelPinsButton",!1),i=>{this._cpb=i,t()}),this.monitorPromise(E("activityPanel","sidebar"),i=>{this._ap=i,t()})}powerOnHandler(){const e=this._ap.sidebar;let t=null;const i=a.after("default",this._cpb,(s,o)=>{const u=()=>o,g=()=>{t===null?t=a.injectCSS("."+e+" { display: none; }"):(t(),t=null)};return r.createElement(r.Fragment,null,r.createElement(u,null),r.createElement("button",{style:{cursor:"pointer",background:"none"},onClick:g},r.createElement("img",{draggable:"false",width:"24",height:"24",src:"/assets/a860a4e9c04e5cc2c8c48ebf51f7ed46.svg",alt:"\u{1F98A}\uFE0F"})))});this.powerOffHandler=()=>{i(),t?.(),t=null}}}function q(){return[new D("blockedMessageHide"),new V("dmCleanup.cpcl"),new v("dmCleanup.nitroCSSFallback",'a[href="/store"] { display: none; }'),new z("nitroHide.upsellAvy"),new _("nitroHide.upsellBanner.editorHook","ProfileBannerSection"),new h("nitroHide.upsellBanner.previewUnlockCSS",["bannerNitroUpsell"],"bannerNitroUpsell","display: none;"),new _("nitroHide.textbox.stickers.loader","StickerPickerLoader"),new v("nitroHide.textbox.stickers.pickerTabCSS","#sticker-picker-tab { display: none; }"),new v("nitroHide.textbox.stickers.pickerIconCSS",'button[aria-label="Open sticker picker"] { display: none; }'),new v("nitroHide.textbox.gift.giftIconCSS",'button[aria-label="Send a gift"] { display: none; }'),new R("paymentSettingsHide"),new h("serverIconHide",["acronym","childWrapper","icon","selected","wrapper"],"icon","display: none;"),new h("serverBannerHide",["bannerImg"],"bannerImg","display: none;"),new _("activityBlock.general.activityStatusComponent","ActivityStatus"),new h("activityBlock.profile.customStatusActivityCSS",["customStatusActivity"],"customStatusActivity","display: none;"),new h("botTagHide",["botTagVerified","botTag"],"botTag","display: none;"),new K("buttonToHideChannelList"),new j("logHelper"),new G("errorFireAlarmTest")]}function J(n,e){e.update("blockedMessageHide",n.blockedMessageHide),e.update("dmCleanup.cpcl",n.dmCleanup||n.nitroHide),e.update("dmCleanup.nitroCSSFallback",n.dmCleanup||n.nitroHide),e.update("nitroHide.upsellAvy",n.nitroHide),e.update("nitroHide.upsellBanner.editorHook",n.nitroHide),e.update("nitroHide.upsellBanner.previewUnlockCSS",n.nitroHide),e.update("nitroHide.textbox.stickers.loader",n.nitroHide),e.update("nitroHide.textbox.stickers.pickerTabCSS",n.nitroHide),e.update("nitroHide.textbox.stickers.pickerIconCSS",n.nitroHide),e.update("nitroHide.textbox.gift.giftIconCSS",n.nitroHide),e.update("paymentSettingsHide",n.paymentSettingsHide),e.update("serverIconHide",n.serverIconHide),e.update("serverBannerHide",n.serverBannerHide),e.update("activityBlock.general.activityStatusComponent",n.activityBlock),e.update("activityBlock.profile.customStatusActivityCSS",n.activityBlock),e.update("botTagHide",n.botTagHide),e.update("buttonToHideChannelList",n.buttonToHideChannelList),e.update("logHelper",n.logHelper),e.update("errorFireAlarmTest",n.errorFireAlarmTest)}const H=new L;H.updateSettings(C());for(let n of q())H.installModule(n);let A=!1;function O(){try{const n=C();H.updateSettings(n),A?J(n,H):H.powerOffAll()}catch(n){console.error(n,"GCAT outer-level manager exception"),P.showToast({title:"GCAT outer-level manager exception",content:"Oh dear..."})}}var Q={onLoad(){A=!0,O(),m.persist.on(k.nests.Events.SET,O)},onUnload(){m.persist.off(k.nests.Events.SET,O),A=!1,O()},settings:N};return Q})(cumcord.pluginData,cumcord.modules.internal,cumcord.ui.toasts,cumcord.modules.common.React,cumcord.patcher,cumcord.modules.webpack,cumcord.utils);
