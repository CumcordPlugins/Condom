(function(s,P,n){"use strict";const l=/https?:\/\/(?:\w+\.)?discord(?:app)?\.com\/channels\/(\d{17,19}|@me)\/(\d{17,19})\/(\d{17,19})/g,g=/\/channels\/(\d+|@me)(?:\/)?(\d+)(?:\/)(\d+)/,{default:C}=s.find(a=>a?.default?.type?.displayName=="ChannelMessage"),I=s.findByDisplayName("Embed"),E=s.findByProps("get","put"),m=s.findByProps("isAccessibleChannelOrThreadPath"),S=s.findByProps("createMessageRecord"),{getGuildIconURL:R}=s.findByProps("getGuildIconURL"),{renderMaskedLinkComponent:B}=s.findByProps("renderMaskedLinkComponent"),M=s.findByProps("getGuild"),A=s.findByProps("getChannel","getDMUserIds"),G=s.findByProps("getMessage","getMessages"),L=s.findByProps("MessageDisplayCompact"),D=s.findByProps("searchResult","message","buttonsContainer"),h=new Set,u=new Map;function U(a){const{message:r}=a,c=r.content.match(l),[,T]=n.React.useState(),_=n.React.useCallback(()=>T({}),[]);if(c){const f=[];for(const H of c){const b=H.match(g)[0],e=m.tryParseChannelPath(b);if(e.messageId==r.id)continue;const o=e.guildId=="@me"?null:M.getGuild(e.guildId),d=A.getChannel(e.channelId),t=G.getMessage(e.channelId,e.messageId)||u.get(e.messageId);if(!t&&!h.has(e.messageId)&&(E.get({url:n.constants.Endpoints.MESSAGES(e.channelId),query:{limit:1,around:e.messageId},retries:2,oldFormErrors:!0}).then(i=>{u.set(e.messageId,S.createMessageRecord(i.body[0])),_()}),h.add(e.messageId)),!t||!d||!o&&e.guildId!="@me")continue;const y=t.content.match(l);if(y){let i=!1;for(const $ of y){const k=$.match(g)[0];if(m.tryParseChannelPath(k).messageId==r.id){i=!0;break}}if(i)continue}const X=e.guildId=="@me"?null:R({id:o.id,icon:o.icon,size:24});f.push(n.React.createElement(I,{embed:{rawDescription:"",author:{name:e.guildId=="@me"?"Direct Message":`${o.name} - #${d.name}`,iconProxyURL:X}},renderLinkComponent:B,renderDescription:()=>n.React.createElement("div",{className:D.message,key:t.id},n.React.createElement(C,{id:"message-link-preview-"+t.id,message:t,channel:d,animateAvatar:!1,subscribeToComponentDispatch:!1,compact:L.MessageDisplayCompact.getSetting()}))}))}return f}return null}const{MessageAccessories:N}=s.findByProps("MessageAccessories");let p;var v=a=>({onLoad(){p=P.after("render",N.prototype,function(r,c){this.props&&c.props.children.push(n.React.createElement(U,{message:this.props.message}))})},onUnload(){p()}});return v})(cumcord.modules.webpackModules,cumcord.patcher,cumcord.modules.common);
